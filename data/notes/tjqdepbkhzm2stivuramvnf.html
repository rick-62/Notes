<h1 id="sam-template"><a aria-hidden="true" class="anchor-heading" href="#sam-template"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>SAM Template</h1>
<h4 id="sources"><a aria-hidden="true" class="anchor-heading" href="#sources"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Sources</h4>
<ul>
<li><a href="https://www.youtube.com/watch?v=QBBewrKR1qg">Mastering the AWS Serverless Application Model (AWS SAM)</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html">AWS SAM Template Developer Guide</a></li>
</ul>
<h1 id="overview"><a aria-hidden="true" class="anchor-heading" href="#overview"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Overview</h1>
<p>Under the hood SAM templates are being converted to Cloudformation templates.</p>
<p>The SAM templates offer a much cleaner and readable alternative to creating Cloudformation templates directly.</p>
<h1 id="sam-templates"><a aria-hidden="true" class="anchor-heading" href="#sam-templates"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Sam Templates</h1>
<h2 id="serverless-resources"><a aria-hidden="true" class="anchor-heading" href="#serverless-resources"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Serverless Resources</h2>
<ul>
<li>AWS::Serverless::Function</li>
<li>AWS::Serverless::Api</li>
<li>AWS::Serverless::HttpApi</li>
<li>AWS::Serverless::SimpleTable</li>
<li>AWS::Serverless::LayerVersion</li>
<li>AWS::Serverless::Application</li>
<li>AWS::Serverless::StateMachine</li>
</ul>
<h3 id="awsserverlessfunction"><a aria-hidden="true" class="anchor-heading" href="#awsserverlessfunction"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::Function</h3>
<p><em>Creates an AWS Lambda</em></p>
<ul>
<li>A lot of events can trigger the lambda</li>
<li>Policy can be selected here (or custom one created)</li>
</ul>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of policy for reading in a specified DynamoDB table</span>
<span class="token key atrule">Policies</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">DynamoDBReadPolicy</span><span class="token punctuation">:</span>
        <span class="token key atrule">TableName</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> SampleTable
</code></pre>
<h3 id="awsserverlessapi"><a aria-hidden="true" class="anchor-heading" href="#awsserverlessapi"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::Api</h3>
<p><em>Creates REST API</em></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of creating API &#x26; using OpenAPI to define API</span>
<span class="token key atrule">MyAPI</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>Api
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">StageName</span><span class="token punctuation">:</span> prod
        <span class="token key atrule">DefinitionUri</span><span class="token punctuation">:</span> ./swagger.yml
</code></pre>
<h3 id="awsserverlesshttpapi"><a aria-hidden="true" class="anchor-heading" href="#awsserverlesshttpapi"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::HttpApi</h3>
<p><em>Supercharged REST API</em></p>
<p>Allows more options and refinement, as well as being quicker etc.</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of HTTP API</span>
<span class="token key atrule">HttpApi</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>HttpApi
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">CorsConfiguration</span><span class="token punctuation">:</span>
            <span class="token key atrule">AllowMethods</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> GET
                <span class="token punctuation">-</span> POST
            <span class="token key atrule">AllowOrigins</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> https<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8080</span>
</code></pre>
<h3 id="awsserverlesssimpletable"><a aria-hidden="true" class="anchor-heading" href="#awsserverlesssimpletable"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::SimpleTable</h3>
<p><em>Creates a DynamoDB table</em></p>
<p>Can specify the Primary Key, capacity &#x26; managed encryption.</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of simple DynamoDB table</span>
<span class="token key atrule">MyTable</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>SimpleTable
</code></pre>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of more complex DynamoDB table definition</span>
<span class="token key atrule">MyTable</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>SimpleTable
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">TableName</span><span class="token punctuation">:</span> my<span class="token punctuation">-</span>table
        <span class="token key atrule">PrimaryKey</span><span class="token punctuation">:</span>
            <span class="token key atrule">Name</span><span class="token punctuation">:</span> id
            <span class="token key atrule">Type</span><span class="token punctuation">:</span> string
        <span class="token key atrule">ProvisionedThroughput</span><span class="token punctuation">:</span>
            <span class="token key atrule">ReadCapacityUnits</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">WriteCapacityUnits</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">Tags</span><span class="token punctuation">:</span>
            <span class="token key atrule">Department</span><span class="token punctuation">:</span> Engineering
            <span class="token key atrule">AppType</span><span class="token punctuation">:</span> Serverless
</code></pre>
<h3 id="awsserverlesslayerversion"><a aria-hidden="true" class="anchor-heading" href="#awsserverlesslayerversion"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::LayerVersion</h3>
<p><em>Creates Lambda Layer</em></p>
<p>Note: can use makefile to build the layer, rather than doing so manually!</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">MyLayer</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>LayerVersion
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span> 
        <span class="token key atrule">LayerName</span><span class="token punctuation">:</span> python<span class="token punctuation">-</span>resources
        <span class="token key atrule">Description</span><span class="token punctuation">:</span> required third party modules for Python
        <span class="token key atrule">ContentUri</span><span class="token punctuation">:</span> MyLambdaLayer/layer.zip
        <span class="token key atrule">CompatibleRuntimes</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Python3.6
        <span class="token key atrule">LicenseInfo</span><span class="token punctuation">:</span> MIT
        <span class="token key atrule">RetentionPolicy</span><span class="token punctuation">:</span> Retain
    <span class="token key atrule">Metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">BuildMethod</span><span class="token punctuation">:</span> python3.6 <span class="token punctuation">|</span> makefile
</code></pre>
<h3 id="awsserverlessapplication"><a aria-hidden="true" class="anchor-heading" href="#awsserverlessapplication"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::Application</h3>
<p><em>Allows us to use a pre-built serverless application</em></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">MyApplication</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>Application
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span> 
        <span class="token key atrule">Location</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//s3.amasonaws.com/bucket/tmpl.yaml
</code></pre>
<h3 id="awsserverlessstatemachine"><a aria-hidden="true" class="anchor-heading" href="#awsserverlessstatemachine"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AWS::Serverless::StateMachine</h3>
<p><em>Creates AWS StepFunction</em></p>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Example of Step Function defintion</span>
<span class="token key atrule">MySampleStateMachine</span><span class="token punctuation">:</span>
    <span class="token key atrule">Type</span><span class="token punctuation">:</span> AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Serverless<span class="token punctuation">:</span><span class="token punctuation">:</span>StateMachine
    <span class="token key atrule">Properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">DefinitionUri</span><span class="token punctuation">:</span> sfn/MyStateMachine.asl.json
        <span class="token key atrule">Role</span><span class="token punctuation">:</span> arn<span class="token punctuation">:</span>aws<span class="token punctuation">:</span>iam<span class="token punctuation">:</span><span class="token punctuation">:</span>role/service<span class="token punctuation">-</span>role/MyRole
        <span class="token key atrule">DefinitionSubstitutions</span><span class="token punctuation">:</span>
            <span class="token key atrule">MyFunctionArn</span><span class="token punctuation">:</span> <span class="token tag">!GetAtt</span> MyFunction.Arn
            <span class="token key atrule">MyDDBTable</span><span class="token punctuation">:</span> <span class="token tag">!Ref</span> TransactionTable   
</code></pre>
<h2 id="globals"><a aria-hidden="true" class="anchor-heading" href="#globals"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Globals</h2>
<p>This is intended to add efficiency to building templates.</p>
<p>Define defaults across resources, by moving properties here which are repeated throughout.</p>
<h2 id="customs-functions-and-parameters"><a aria-hidden="true" class="anchor-heading" href="#customs-functions-and-parameters"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Customs functions and parameters</h2>
<p>Can be used to create parametrised template.</p>
<h3 id="pseudo-parameters"><a aria-hidden="true" class="anchor-heading" href="#pseudo-parameters"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Pseudo parameters</h3>
<p>Can be referenced from within SAM template:</p>
<ul>
<li>AWS::AccountId</li>
<li>AWS::Region</li>
<li>AWS::StackId</li>
<li>AWS::StackName</li>
<li>AWS::UrlSuffix</li>
<li>etc...</li>
</ul>
<h3 id="intrinsic-functions"><a aria-hidden="true" class="anchor-heading" href="#intrinsic-functions"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Intrinsic functions</h3>
<ul>
<li>!GetAtt</li>
<li>!Ref</li>
<li>!Sub</li>
<li>!Split</li>
<li>!Join</li>
<li>etc...</li>
</ul>
<h3 id="examples"><a aria-hidden="true" class="anchor-heading" href="#examples"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Examples</h3>
<pre class="language-yaml"><code class="language-yaml"><span class="token comment"># Output endpoint for Amazon API Gateway</span>
<span class="token tag">!Sub</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>ServerlessHttpApi<span class="token punctuation">}</span>.execute<span class="token punctuation">-</span>api.$<span class="token punctuation">{</span>AWS<span class="token punctuation">:</span><span class="token punctuation">:</span>Region<span class="token punctuation">}</span>.amazonaws.com
</code></pre>